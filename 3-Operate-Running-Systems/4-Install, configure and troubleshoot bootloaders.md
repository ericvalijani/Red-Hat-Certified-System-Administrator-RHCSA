The **Red Hat Certified System Administrator (RHCSA)** exam tests candidates on essential Linux system administration tasks. One of the topics covered in the exam involves the **boot loader** and managing system boot processes.

### What is a Boot Loader?
A **boot loader** is software responsible for loading the Linux kernel into memory and starting the operating system when the system boots up. For Red Hat-based systems (such as RHEL), **GRUB2 (GRand Unified Bootloader)** is the default boot loader. It allows users to select between multiple kernels or operating systems (if installed).

#### Key Concepts You Should Know for the RHCSA Exam
1. **GRUB2 Configuration Files**:  
   The main GRUB2 configuration file is located at `/boot/grub2/grub.cfg`, but it is **auto-generated**. Do not edit this file directly. Instead, changes should be made in files like `/etc/default/grub` and `/etc/grub.d/`.

2. **Regenerating GRUB Configuration**:  
   After making changes to the GRUB configuration (like modifying the default kernel), you must regenerate the `grub.cfg` file using the command:
   ```
   grub2-mkconfig -o /boot/grub2/grub.cfg
   ```

3. **Setting the Default Kernel**:  
   If there are multiple kernels installed, you might need to set a specific kernel as the default one. This can be done using the `grubby` command or editing the `/etc/default/grub` file.

   Example command:
   ```
   grubby --set-default /boot/vmlinuz-<kernel-version>
   ```

4. **Rescue and Emergency Modes**:  
   Understanding how to boot into rescue mode or emergency mode is critical. Rescue mode can be used if you cannot boot the system normally. You can edit the GRUB boot line (by pressing **`e`** at the GRUB menu during boot) to add `systemd.unit=rescue.target` for rescue mode or `systemd.unit=emergency.target` for emergency mode.

   **Commands**:
   ```bash
   systemctl rescue
   systemctl emergency
   ```

5. **Password Protecting GRUB2**:  
   For security reasons, you may want to password-protect the GRUB menu to prevent unauthorized users from changing boot parameters.

   To create a password hash:
   ```
   grub2-setpassword
   ```

   This command generates the password hash that will be added to `/etc/grub.d/40_custom` or the GRUB configuration.

   ```
   [root@Server2 ~]# cat /boot/grub2/user.cfg
   GRUB2_PASSWORD=grub.pbkdf2.sha512.10000.A3731C41BD3FBD13BA543806344018B24DEDDE980032C406E4E8A1369BCC02390922D86B9F68F772B22299E7AE144CC330FC2FBE5CB8AF666392A50F1B120056.418F448F1434292D8A01199B700ADA7303F15C9B83139C8DF5B0BF86CFA4C41D52D3DE99159DDD4277C0739A3649A224EEE94D9DBA88374A42D97C84423D9FD0
   ```



6. **Modifying Kernel Boot Parameters**:  
   You should know how to temporarily change kernel boot parameters (such as adding `rd.break` or `selinux=0`) to troubleshoot or modify the system state. This is done by pressing **`e`** at the GRUB menu, editing the boot parameters, and then booting with the modified settings.


### 5. **Set a Custom Boot Timeout for GRUB2**
   **Task:**  
   Modify the GRUB2 configuration so that the boot menu waits 30 seconds before automatically selecting the default kernel.

   **Steps:**
   1. Edit the file `/etc/default/grub` and change the value of `GRUB_TIMEOUT`:
      ```
      GRUB_TIMEOUT=30
      ```
   2. Update the GRUB configuration:
      ```
      grub2-mkconfig -o /boot/grub2/grub.cfg
      ```
   3. Reboot the system and verify the timeout behavior.

### 6. **Boot with a Specific Kernel Only Once**
   **Task:**  
   You want to boot from an older kernel for troubleshooting purposes, but after rebooting, the system should revert to the default kernel.

   **Steps:**
   1. List the available kernels to find the desired one:
      ```
      grubby --info=ALL
      ```
   2. Set the system to use the specific kernel on the next boot only:
      ```
      grubby --set-default /boot/vmlinuz-<kernel-version> --once
      ```
   3. Reboot and verify the system boots into the desired kernel. On the next reboot, the system should return to the default kernel.

### 9. **Recover a Broken GRUB Installation**
   **Task:**  
   Your system fails to boot because the GRUB bootloader is corrupt. Boot into rescue mode and reinstall GRUB on the MBR (Master Boot Record).

   **Steps:**
   1. Boot the system using a **live RHEL DVD/USB** and choose the **Rescue a Red Hat system** option.
   2. Once in rescue mode, chroot into the system's root partition:
      ```
      chroot /mnt/sysimage
      ```
   3. Reinstall GRUB on the MBR (assuming the boot device is `/dev/sda`):
      ```
      grub2-install /dev/sda
      ```
   4. Rebuild the GRUB configuration:
      ```
      grub2-mkconfig -o /boot/grub2/grub.cfg
      ```
   5. Exit and reboot the system to verify it now boots correctly.

### 10. **Enable or Disable Graphical Boot in GRUB2**
   **Task:**  
   Change the boot process to show a graphical boot screen (splash screen) or disable it for text-only boot output.

   **Steps:**
   1. Edit `/etc/default/grub`:
      - To **enable** graphical boot:
        ```
        GRUB_CMDLINE_LINUX="rhgb quiet"
        ```
      - To **disable** graphical boot (text-only boot):
        ```
        GRUB_CMDLINE_LINUX=""
        ```
   2. Update the GRUB configuration:
      ```
      grub2-mkconfig -o /boot/grub2/grub.cfg
      ```
   3. Reboot the system to apply the changes.

---



________________________________________________________________________________________________






### 5. **Recovering a Corrupt GRUB**
   - You might encounter a scenario in the exam where GRUB fails, and youâ€™ll need to restore it.
   
   **Example task**: "GRUB is corrupted, and you need to reinstall GRUB to restore the bootloader."
   - Boot from a **live RHEL installation** or **rescue mode**.
   - Mount the system partitions:
     ```bash
     mount /dev/sda1 /mnt  # Assuming /dev/sda1 is your /boot
     mount --bind /dev /mnt/dev
     mount --bind /proc /mnt/proc
     mount --bind /sys /mnt/sys
     chroot /mnt
     ```
   - Reinstall GRUB on the bootloader:
     ```bash
     grub2-install /dev/sda
     grub2-mkconfig -o /boot/grub2/grub.cfg
     exit
     reboot
     ```

________________________________________________________________________________________________



## Install Grub bootloader

in order to go to the boot menu, you can press `F8` OR keep `shift`, during the booting process.

we can press `e` to edit the grub settings and press `Ctrl+X` to reboot with the new settings.

this setting is temporary, if we wanna make it permanent, we can change the `/etc/default/grub`

________________________________________________________________________________________________

OR we select "troubleshooting" instead of normal CentOS Install

________________________________________________________________________________________________


in the boot menu, select the "Rescue a CentOS Stream system"


________________________________________________________________________________________________


then select "1) Continue"


________________________________________________________________________________________________



Press ENTER to get a shell:


________________________________________________________________________________________________


```bash
chroot /mnt/sysroot
```

________________________________________________________________________________________________

`/boot/grub2/grub.cfg`

On `BIOS-based` machines, issue the following command as root:

```bash
grub2-mkconfig -o /boot/grub2/grub.cfg
```

`/boot/efi/EFI/redhat/grub.cfg`

On `UEFI-based` machines, issue the following command as root:

```bash
grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg
```



________________________________________________________________________________________________


we will search for the partition that has the `/boot`:

in our case it's sda1

```bash
lsblk
```

________________________________________________________________________________________________

## `grub2-install /dev/sda`

`install` the grub on the disk that has the boot partition:

```bash
grub2-install /dev/sda
```

________________________________________________________________________________________________


exit and reboot

```bash
exit
exit
```

________________________________________________________________________________________________


## change the Grub settings

## `/etc/default/grub`


```bash
[bob@centos-host ~]$ cat /etc/default/grub

GRUB_TIMEOUT=1
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop"
GRUB_DISABLE_RECOVERY="true"
GRUB_ENABLE_BLSCFG=true
```

________________________________________________________________________________________________




change the timeout of the grub:

```bash
GRUB_TIMEOUT=1
```

________________________________________________________________________________________________


after changing this file, we should regenerate the config file:

`BIOS-based`:

```bash
grub2-mkconfig -o /boot/grub2/grub.cfg
```

`UEFI-based`:

```bash
grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg
```


________________________________________________________________________________________________

## `grubby --info ALL`

see current Grub settings:

```bash
[bob@centos-host ~]$ sudo dnf install grubby
```

```bash
[bob@centos-host ~]$ sudo grubby --info ALL
index=0
kernel="/boot/vmlinuz-4.18.0-240.1.1.el8_3.x86_64"
args="ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop $tuned_params"
root="UUID=a62c5b49-755e-41b0-9d36-de3d95e17232"
initrd="/boot/initramfs-4.18.0-240.1.1.el8_3.x86_64.img $tuned_initrd"
title="CentOS Linux (4.18.0-240.1.1.el8_3.x86_64) 8"
id="99023f8aa5784c9c99a1c16aebb7ffa6-4.18.0-240.1.1.el8_3.x86_64"
```

________________________________________________________________________________________________


### change the default kernel:


```bash
[bob@centos-host ~]$ sudo grubby --set-default=/boot/vmlinuz-4.18.0-240.1.1.el8_3.x86_64
```

________________________________________________________________________________________________

### change the default index of the kernel in the boot menu:

```bash
[bob@centos-host ~]$ sudo grubby --set-default-index=1
```

________________________________________________________________________________________________


```bash
[bob@centos-host ~]$ man grubby
```

________________________________________________________________________________________________


Possible boot parameters that you can pass into the linux kernel:

```bash
[bob@centos-host ~]$ man bootparam
```

```bash
[bob@centos-host ~]$ man dracut.cmdline
```


________________________________________________________________________________________________



### On ServerA, ensure that boot messages are displayed, not silenced, for troubleshooting purposes.




- 1: Modify GRUB Configuration File `/etc/default/grub`



- 2: Locate the "GRUB_CMDLINE_LINUX" line and remove `rhgb quiet`.



- 3: Generate a new GRUB configuration file based on the current system configuration:

```bash
grub2-mkconfig -o /boot/grub2/grub.cfg
```


- 4: Restart the system for the changes to take effect:

```bash
reboot
```



________________________________________________________________________________________________



### Create a backup of the Master Boot Record (MBR) located on the device "/dev/sda" of ServerA. Store the backup in the file "/backup/mbr.img":

- Block Size: 512 bytes

- Number of Blocks Copied: 1

- Verification: Confirm successful backup creation




```bash
mkdir -p /backup

dd if=/dev/sda of=/backup/mbr.img bs=512 count=1 status=progress
```


________________________________________________________________________________________________








