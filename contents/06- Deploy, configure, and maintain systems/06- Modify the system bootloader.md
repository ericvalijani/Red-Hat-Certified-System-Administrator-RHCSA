The RHCSA exam topic **"Modify the system bootloader"** refers to tasks related to managing the **GRUB2** bootloader, which is the default bootloader used in RHEL-based systems. GRUB2 (GRand Unified Bootloader version 2) is responsible for loading the operating system kernel and initializing the boot process.

In the RHCSA exam, you may be asked to perform tasks such as changing the default kernel, modifying boot parameters, or recovering access to a system by modifying GRUB2 at boot time.


---

### **What You Need to Know:**
1. **GRUB2 configuration**: How to modify boot parameters in the **GRUB2** configuration files.
2. **Changing the default boot entry**: How to set a specific kernel or operating system as the default to boot.
3. **Modifying kernel boot parameters**: Adding or changing kernel parameters in GRUB2.
4. **Regenerating the GRUB configuration**: After making changes to the configuration files, you must regenerate the GRUB2 configuration for the changes to take effect.
5. **Accessing GRUB at boot time**: Temporarily modifying boot entries at the GRUB menu for troubleshooting or recovery.
6. **Ensuring persistence**: Changes to the bootloader should persist across reboots.

---

### **1. GRUB2 Configuration Files**

- **`/etc/default/grub`**: The main configuration file where you can change default settings like the default kernel or timeout.
- **`/boot/grub2/grub.cfg`**: The actual GRUB2 configuration file. This file is automatically generated and should not be edited directly.

After modifying the **`/etc/default/grub`** file, you must regenerate the **`/boot/grub2/grub.cfg`** file using the **`grub2-mkconfig`** command.

---

### **2. Changing the Default Boot Entry**

By default, GRUB2 boots the first entry in the boot list. You can change the default entry to a different kernel or operating system.

#### **Example Task 1: Set a Specific Kernel as the Default to Boot**

**Task:** Set the system to boot using an older kernel by default.

1. **List all available kernels**:
   ```bash
   awk -F\' '$1=="menuentry " {print i++ " : " $2}' /boot/grub2/grub.cfg
   ```

   **Example Output**:
   ```
   0 : CentOS Linux (4.18.0-240.el8.x86_64) 8 (Core)
   1 : CentOS Linux (4.18.0-221.el8.x86_64) 8 (Core)
   ```

2. **Edit the `/etc/default/grub` file**:
   ```bash
   sudo nano /etc/default/grub
   ```

3. **Change the `GRUB_DEFAULT` value to the desired entry**:
   ```
   GRUB_DEFAULT=1
   ```

   **Explanation**: This sets the second entry in the list (index `1`) as the default kernel to boot.

4. **Regenerate the GRUB2 configuration**:
   ```bash
   sudo grub2-mkconfig -o /boot/grub2/grub.cfg
   ```

5. **Reboot the system** and verify the new kernel is used:
   ```bash
   uname -r
   ```

   **Explanation**: After rebooting, the system should boot into the kernel specified by `GRUB_DEFAULT`.

---

### **3. Modifying Kernel Boot Parameters**

You may need to modify kernel parameters to enable or disable certain features, such as adding the **`rhgb`** (Red Hat graphical boot) or **`quiet`** options for silent booting or adding **`selinux=0`** to disable SELinux temporarily.

#### **Example Task 2: Add Kernel Boot Parameters (Disabling SELinux)**

**Task:** Temporarily disable SELinux by adding the **`selinux=0`** kernel parameter to GRUB2.

1. **Edit the `/etc/default/grub` file**:
   ```bash
   sudo nano /etc/default/grub
   ```

2. **Modify the `GRUB_CMDLINE_LINUX` line** to include the **`selinux=0`** parameter:
   ```
   GRUB_CMDLINE_LINUX="crashkernel=auto rhgb quiet selinux=0"
   ```

   **Explanation**: This disables SELinux at boot by passing **`selinux=0`** to the kernel.

3. **Regenerate the GRUB2 configuration**:
   ```bash
   sudo grub2-mkconfig -o /boot/grub2/grub.cfg
   ```

4. **Reboot the system**:
   ```bash
   sudo reboot
   ```

5. **Verify that SELinux is disabled** after the reboot:
   ```bash
   sestatus
   ```

   **Explanation**: The `sestatus` command should show **SELinux status: disabled**.

---

### **4. Temporarily Modifying GRUB Boot Parameters at Boot Time**

If you cannot access the system (e.g., due to boot issues), you can temporarily modify GRUB parameters at boot time through the GRUB menu.

#### **Example Task 3: Modify GRUB Boot Parameters Temporarily to Enter Rescue Mode**

**Task:** Boot into rescue mode by editing the kernel parameters at the GRUB boot menu.

1. **Access the GRUB boot menu** during startup:
   - Restart the system and press **`Esc`** or **`Shift`** during boot to access the GRUB menu.

2. **Select the kernel entry** you want to modify and press **`e`** to edit the boot parameters.

3. **Find the line that starts with `linux`** and add **`systemd.unit=rescue.target`** at the end of the line.

   Example modified line:
   ```
   linux /vmlinuz-4.18.0-240.el8.x86_64 root=/dev/mapper/rhel-root ro crashkernel=auto rhgb quiet systemd.unit=rescue.target
   ```

4. **Press `Ctrl + X`** to boot with the modified parameters.

   **Explanation**: This boots the system into **rescue mode**. These changes are temporary and will not persist across reboots.

---

### **5. Regenerating the GRUB2 Configuration**

Any time you make changes to `/etc/default/grub` (e.g., changing the default kernel or adding kernel parameters), you must regenerate the GRUB configuration to apply those changes.

#### **Example Task 4: Regenerate the GRUB2 Configuration**

**Task:** Regenerate the GRUB2 configuration file to apply changes made to `/etc/default/grub`.

**Command:**
```bash
sudo grub2-mkconfig -o /boot/grub2/grub.cfg
```

**Explanation**:
- **`grub2-mkconfig`** creates a new GRUB2 configuration file at `/boot/grub2/grub.cfg` based on the settings in `/etc/default/grub`.

---

### **6. Ensuring Persistence**

By default, all changes made to `/etc/default/grub` and the regenerated `/boot/grub2/grub.cfg` file will persist across reboots. Always ensure that after any changes to GRUB configuration, the system is rebooted to verify the modifications.

---

### **7. Troubleshooting Boot Issues**

If a system fails to boot due to incorrect GRUB configuration changes, you can manually modify GRUB at boot time (as shown in Example Task 3) to troubleshoot the issue. Common troubleshooting techniques include booting into **rescue mode** or **single-user mode** to fix incorrect configurations.

---

### Summary of Skills for RHCSA Exam on Modifying the Bootloader:
1. **Change the default boot entry** using `GRUB_DEFAULT` in `/etc/default/grub`.
2. **Modify kernel boot parameters** by editing `GRUB_CMDLINE_LINUX` in `/etc/default/grub`.
3. **Regenerate the GRUB configuration** after changes using `grub2-mkconfig`.
4. **Temporarily modify GRUB parameters at boot time** for troubleshooting or recovery.
5. **Verify bootloader changes** by rebooting and checking the system's state (e.g., kernel version or boot parameters).
